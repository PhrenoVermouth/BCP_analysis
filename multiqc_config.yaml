run_modules:
  - star
  - custom_content

module_order:
  - star
  - custom_content

title: "BCP Single-Cell QC Report"

custom_data:
  total_metaqc:
    section_name: "Total_metaQC"
    description: "Integrated QC metrics across Scrublet, filtering, and SoupX"
    file_format: "tsv"
    plot_type: "table"
    sample_names_first_col: true
    pconfig:
      sortRows: false
      modify_columns:
        "Doublet_fraction":      
          d_places: 3           

  # Below here are all images generated by python scripts
  img_marker_genes_heatmap:
    section_name: "Marker genes heatmaps"
    description: "Top marker genes per cluster; heatmap scaled by row; shows cluster-specific markers."
    file_format: "png"
    plot_type: "image"

  img_soupx_combined:
    section_name: "SoupX Analysis"
    description: "Contamination estimation and ambient RNA removal side-by-side"
    file_format: "png"
    plot_type: "image"

  img_soupx_result:
    section_name: "SoupX ambient RNA removal"
    description: "Ambient RNA removel profile by cells"
    file_format: "png"
    plot_type: "image"

  img_soupx_progress:
    section_name: "SoupX ambient RNA identification"
    description: "Ambient RNA estimation profile by cells"
    file_format: "png"
    plot_type: "image"

  img_umap_leiden_qc2:
    section_name: "UMAP leiden QC2"
    description: "UMAP colored by Leiden clusters after QC2 filtering; parameters: resolution=1.0."
    file_format: "png"
    plot_type: "image"

  img_scatter_doublet_qc1:
    section_name: "Scatter doublet highlight QC1"
    description: "Doublet score vs. nCount_RNA; highlighted putative doublets prior to mitochondrial filtering."
    file_format: "png"
    plot_type: "image"
  img_knee_plot:
    section_name: "Knee plot"
    description: "Barcode rank plot with expected number of cells marker."
    file_format: "png"
    plot_type: "image"

  img_violin_comparison_qc1:
    section_name: "Violin comparison QC1"
    description: "QC1 distributions after doublet removal; compare to initial state."
    file_format: "png"
    plot_type: "image"

  img_violin_mito_qc2:
    section_name: "Violin before and after mito filtering QC2"
    description: "nCount_RNA / nFeature_RNA distributions before and after mitochondrial filtering."
    file_format: "png"
    plot_type: "image"

  img_umap:
    section_name: "UMAP and QC per cluster"
    description: "UMAP and QC per cluster"
    file_format: "png"
    plot_type: "image"

  img_dotplot:
    section_name: "Markers identified per cluster"
    description: "Markers identified per cluster"
    file_format: "png"
    plot_type: "image"



ignore_images: false

# Search patterns: keys must match the custom_data IDs
sp:
  total_metaqc:
    fn: "*_total_metaqc_mqc.tsv"
  img_marker_genes_heatmap:
    fn: "*_marker_genes_heatmap.png"
  img_umap_leiden_qc2:
    fn: "*_umap_leiden_QC2.png"
  img_scatter_doublet_qc1:
    fn: "*_scatter_doublet_highlight_QC1.png"
  img_knee_plot:
    fn: "*_knee_plot.png"
  img_violin_comparison_qc1:
    fn: "*_violin_comparison_QC1.png"
  img_violin_mito_qc2:
    fn: "*_violin_mito_filtering_QC2.png"
  img_soupx_combined:
    fn: "*_soupx_combined.png"
  img_soupx_result:
    fn: "*_ambient_RNA_removed.png"
  img_soupx_progress:
    fn: "*_contamination_estimation.png"
  img_umap:
    fn: "*_umap_leiden_QC2.png"
  img_dotplot:
    fn: "*_marker_genes_dotplot.png"



custom_content:
  order:
    - total_metaqc
    - img_knee_plot
    - img_soupx_combined
    - img_soupx_progress
    - img_soupx_result
    - img_scatter_doublet_qc1
    - img_violin_comparison_qc1
    - img_violin_mito_qc2
    - img_umap_leiden_qc2
    - img_marker_genes_heatmap
    - img_umap
    - img_dotplot

# Must be a mapping (dict), not a list, in MultiQC v1.21
report_section_order:
  "general_stats": 10
  "star": 20
  "custom_content:total_metaqc": 30
  "custom_content:img_knee_plot": 60
  "custom_content:img_soupx_combined": 65
  "custom_content:img_soupx_progress": 70
  "custom_content:img_soupx_result": 80
  "custom_content:img_scatter_doublet_qc1": 85
  "custom_content:img_violin_comparison_qc1": 90
  "custom_content:img_violin_mito_qc2": 100
  "custom_content:img_umap": 110
  "custom_content:img_dotplot": 120
